<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css">
    <title>{{ data.SITE_NAME }} - Booking Confirmation</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>{{ data.SITE_NAME }}</h1>

    <form action="/generate_document" method="POST">
        <!-- Customer Information -->
        <div class="Container">
            <fieldset>
                <legend>Customer Information</legend>
                <label for="customer_name">Name</label>
                <input type="text" id="customer_name" name="customer_name" required><br>

                <label for="customer_email">Email</label>
                <input type="email" id="customer_email" name="customer_email" required><br>

                <label for="customer_phone">Phone</label>
                <input type="text" id="customer_phone" name="customer_phone" required><br>
            </fieldset>

            <!-- Child Information -->
            <fieldset>
                <legend>Child Information</legend>
                <label for="child_name">Name</label>
                <input type="text" id="child_name" name="child_name" required><br>

                <label for="child_age">Age</label>
                <input type="number" id="child_age" name="child_age" required><br>
            </fieldset>

            <!-- Party Information -->
            <fieldset>
                <legend>Party Information</legend>

                <label for="party_date">Date</label>
                <input type="date" id="party_date" name="party_date" required><br>

                <label for="party_start_time">Start Time</label>
                <input type="time" id="party_start_time" name="party_start_time" required><br>

                <label for="party_end_time">End Time</label>
                <input type="time" id="party_end_time" name="party_end_time" required><br>

                <label for="party_type">Party Type</label>
                <select id="party_type" name="party_type" required>
                    {% for partyType, cost in data.PARTY_TYPES.items() %}
                        <option value="{{ partyType }}">{{ partyType }}</option>
                    {% endfor %}
                </select><br>

                <label for="party_room">Party Room</label>
                <select id="party_room" name="party_room" required>
                    <option value="">Select Party Room</option>
                </select><br>

                <label for="party_food_room">Party Food Room</label>
                <select id="party_food_room" name="party_food_room" required>
                    <option value="">Select Food Room</option>
                </select><br>
            </fieldset>

            <!-- Admin Information -->
            <fieldset>
                <legend>Admin Information</legend>

                <label for="date_booked">Date Booked</label>
                <input type="date" id="date_booked" name="date_booked" required><br>

                <label for="staff_member">Staff Member</label>
                <input type="text" id="staff_member" name="staff_member" required><br>
            </fieldset>
        </div>

        <div class="ButtonContainer">
            <button type="submit">Generate Confirmation</button>
        </div>

    </form>

    <script>
        $(document).ready(function() {
            // Function to update activity rooms based on party type
            function updateActivityRooms(partyType) {
                $.ajax({
                    url: '/room_mapping',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ party_type: partyType }),
                    success: function(response) {
                        $('#party_room').empty();
                        $('#party_room').append('<option value="">Select Party Room</option>');
                        response.forEach(function(room) {
                            $('#party_room').append(`<option value="${room}">${room}</option>`);
                        });

                        // Automatically trigger food room update based on the first room
                        const firstRoom = $('#party_room').val();
                        if (firstRoom) {
                            updateFoodRooms(firstRoom);
                        }
                    }
                });
            }

            // Function to update food rooms based on party room
            function updateFoodRooms(partyRoom) {
                $.ajax({
                    url: '/room_mapping',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ party_room: partyRoom }),
                    success: function(response) {
                        $('#party_food_room').empty();
                        $('#party_food_room').append('<option value="">Select Food Room</option>');
                        response.forEach(function(foodRoom) {
                            $('#party_food_room').append(`<option value="${foodRoom}">${foodRoom}</option>`);
                        });
                    }
                });
            }

            // Update rooms when party type is changed
            $('#party_type').change(function() {
                let partyType = $(this).val();
                updateActivityRooms(partyType);
            });

            // Update food rooms when activity room is changed
            $('#party_room').change(function() {
                let partyRoom = $(this).val();
                updateFoodRooms(partyRoom);
            });

            // Trigger initial room updates on page load based on the first selected party type
            const initialPartyType = $('#party_type').val();
            if (initialPartyType) {
                updateActivityRooms(initialPartyType);
            }
        });
    </script>
</body>
</html>
